<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("./partials/head") %>
    <title>Blog</title>
  </head>
  <body>
    <%- include("./partials/nav") %>

    <div class="container mt-4">
        <h1><%= blog.title %></h1>
        <img src="<%= blog.coverImageURL || '/images/default.jpg' %>" width="400px" />
        <p class="fs-5 lh-lg" style="white-space: pre-line;">
          <%= blog.body %>
        </p>
    </div>

    <div class="container mt-4">
      <img src="<%= blog.createdBy.profileImageURL || '/images/defaultpfp.jpg' %>" width="50px"> <%= blog.createdBy.fullName %>
    </div>

    <div class="container my-5">
      <h3 class="mb-4">Comments (<%= comments.length %>)</h3>

      <% if (locals.user) { %>
        <!-- Add Comment Form -->
        <form 
          action="/blog/comment/<%= blog._id %>" 
          method="post" 
          class="mb-4"
        >
          <div class="mb-3">
            <textarea
              class="form-control"
              name="content"
              rows="3"
              placeholder="Write a comment..."
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary btn-sm">
            Submit
          </button>
        </form>
      <% } %>

      <!-- Comments List -->
      <div class="d-flex flex-column gap-4">
        <% comments.forEach(comment => { %>
          <div class="border rounded p-3">

            <div class="d-flex align-items-center mb-2 gap-3">
              <img
                src="<%= comment.createdBy.profileImageURL || '/images/defaultpfp.jpg' %>"
                class="rounded-circle"
                width="45"
                height="45"
                alt="user"
              />

              <div>
                <div class="fw-semibold">
                  <%= comment.createdBy.fullName %>
                </div>
                <small class="text-muted">
                  <%= comment.createdAt.toDateString() %>
                </small>
              </div>
            </div>

            <p class="mb-0" style="white-space: pre-line;">
              <%= comment.content %>
            </p>

          </div>
        <% }) %>
      </div>
    </div>

    <%- include("./partials/scripts") %>
  </body>
</html>